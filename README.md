## Описание проекта

Этот проект представляет собой чат-систему с функционалом аутентификации, обмена сообщениями и администрирования каналов. Он построен с использованием **FastAPI** и **SQLAlchemy** для создания API и работы с базой данных.

Проект включает в себя следующие основные компоненты:

- **Аутентификация пользователей**: Регистрация, логин и создание JWT токенов.
- **Обмен сообщениями**: Возможность отправки и получения сообщений в каналах, просмотр истории сообщений.
- **Модерация**: Возможность блокировать/разблокировать пользователей, а также создавать и удалять каналы, добавлять/исключать пользователей к каналам.
- **WebSocket**: Для обмена сообщениями в реальном времени.

## Структура проекта

Проект состоит из нескольких основных модулей:

- **auth**: Модуль для аутентификации и создания токенов.
- **messages**: Модуль для работы с сообщениями (получение сообщений из канала).
- **moderator**: Модуль для управления пользователями и каналами, доступен только модераторам.
- **config**: Конфигурационные параметры (секретный ключ, алгоритм и время жизни токенов).
- **crud**: Логика работы с базой данных (создание пользователей, сообщений, каналов и т.д.).
- **database**: Настройки для подключения к базе данных PostgreSQL.
- **dependencies**: Зависимости для извлечения данных из запросов (например, текущий пользователь, сессия базы данных).
- **main**: Главный файл, который запускает приложение и инициализирует маршруты.
- **models**: Модели данных, определяющие структуру таблиц в базе данных, например, для пользователей, каналов, сообщений и т.д. Эти модели используются для взаимодействия с базой данных.
- **schemas**: Схемы Pydantic, которые описывают, как должны выглядеть данные, передаваемые через API. Эти схемы используются для валидации и сериализации данных, поступающих от пользователей или отправляемых на клиент.
- **websocket**: Модуль для обработки WebSocket-соединений, обеспечивающий двустороннюю связь в реальном времени между клиентами и сервером, например, для отправки сообщений и обновлений в реальном времени.

## Логика работы

1. **Аутентификация**: Пользователь регистрируется через эндпоинт `/register`, после чего может получить JWT токен через эндпоинт `/token` для доступа к защищённым маршрутам.
2. **Сообщения**: Пользователи могут отправлять и получать сообщения в канале. Эндпоинт `/messages/{channel_id}/` позволяет получить список сообщений для указанного канала.
3. **Модерация**: Модератор может блокировать и разблокировать пользователей, а также управлять каналами (создавать/удалять каналы и добавлять пользователей в каналы).
4. **WebSocket**: Через эндпоинт `/ws/{channel_id}` пользователи могут подключаться к каналу в реальном времени и обмениваться сообщениями.

## Инструкция по запуску

### Требования

- Python 3.8+
- PostgreSQL
- Docker

### Запуск (деплой) решения

1. Клонируйте репозиторий:

```bash
git clone https://github.com/TodayMueller/Atom_chat.git
cd Atom_chat
```

2. Запустите проект через Docker:

```bash
docker-compose up --build
```

Все необходимые зависимости будут установлены автоматически.

Проект будет доступен по порту `8000`.

## Эндпоинты

### Аутентификация

- `POST /auth/register`: Регистрация нового пользователя.
- `POST /auth/token`: Получение JWT токена для аутентифицированного пользователя.

### Сообщения

- `GET /messages/{channel_id}/`: Получение истории сообщений для указанного канала.

### Модерация

- `POST /moderator/block_user/{user_id}`: Блокировка пользователя.
- `POST /moderator/unblock_user/{user_id}`: Разблокировка пользователя.
- `POST /moderator/create_channel`: Создание нового канала.
- `DELETE /moderator/delete_channel/{channel_id}`: Удаление канала.
- `POST /moderator/add_user_to_channel`: Добавление пользователя в канал.
- `DELETE /moderator/remove_user_from_channel`: Удаление пользователя из канала.

### WebSocket

- `WS /ws/{channel_id}`: Обмен сообщениями в реальном времени (для пользователей с доступом к каналу).

## Примечания

- Для добавления/удаления каналов и добавления/удаления пользователей на канал используются эндпоинты, доступные только модераторам.
- Токены JWT имеют срок действия, который можно настроить в конфигурации проекта.
- При первом запуске база данных будет создана автоматически и заполнена тестовыми данными.
